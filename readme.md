
# autocdn

## CDN IP优选与自动切换工具

本工具作为cfnat的开源替代品，能够实现完全serverless运行，只需要在客户端本地运行，即可自动根据,已载入的IP地址，自动切换到延迟较低的IP。响应速度远远高于dns切换，并且不需要手动修改hosts

## 功能

- 自动检测并切换到延迟更低的 CDN 节点。
- 响应速度显著高于 DNS 切换
- 配置简单，自动路由，无需用户手动修改 `hosts`

---

## 简介

用户只需把浏览器http proxy设置为127.0.0.1:8081（默认，也可修改），即可体验cdn自动加速，用户体验与延迟响应速度，远远高于cdn官方的dns切换以及anycast。并且对于不是cdn的网站，会自动直连，不会被路由到cdnip上，用户浏览体验好。

## 特性(Features)

1. **智能免DNS 自动切换**  
   - 拦截 `nslookup` 查询  
   - 如果域名属于 CDN，则自动路由到延迟最低的 CDN 节点  
   - 非 CDN 域名则直接连接原始 IP，不影响正常网络访问

2. **延迟学习优化**  
   - 每次通过 CDN 访问时，都会记录延迟数据  
   - 自动排序延迟较低的IP，从而为下次访问提供更高的速度。

3. **节点健康检查**  
   - 延迟大于 `800ms` 的节点会被自动剔除  
   - 无法连接的节点会被移出候选列表  
   - 保证列表始终只有可用的高性能节点
   - 高延迟节点与无法连接节点自动剔除，如果cdn节点无法连接,或者延迟高于800ms，会自动从待选列表中剔除

---

## 📦 安装与运行

### 运行命令
```bash
./autocdn 127.0.0.1:8081 ips.txt debug=on/off(Optional,default=off)
```

### 参数说明
- `./autocdn` - 程序可执行文件名
- `127.0.0.1:8081` - HTTP Proxy 监听地址
- `ips.txt` - 存储 CDN 优选 IP 列表（以 `\n` 分隔）
- `debug=on/off` - 是否开启调试模式（默认 `off`）

---

## 🚀 使用方法

1. 准备一个包含候选 CDN IP 的 `ips.txt` 文件
ips.txt为以下格式：
```text
192.168.x.x
192.168.x.x:443
192.168.x.x:8443
cdn.mydomain.com
cdn.mydomain.com:6443
```
可以填入cdnIP，以及指向cdn的域名以及端口

如果没有地址没有携带端口，那么会使用默认的443端口进行连接

<br>

2. 启动程序：
   ```bash
   ./autocdn 127.0.0.1:8081 ips.txt
   ```
   
<br>
  
3. 将浏览器或系统的 **HTTP Proxy** 设置为 `127.0.0.1:8081`

<br>

4. 享受**自动加速**体验：
   - CDN 网站将自动切换至延迟最低的节点  
   - 非 CDN 网站将直连，不经过代理

### raw TCP端口

如果你需要 raw TCP端口（类似cfnat），而不是HTTP Proxy端口。可以使用gost进行反代。

比如你需要127.0.0.1:443，该端口映射到cdn端口。

可以使用gost启动一个反代服务器。
```bash
./gost -L=sni://127.0.0.1:443 -F http://127.0.0.1:8081
```
